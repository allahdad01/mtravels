# Disable directory listing
Options -Indexes

# Set default character set
AddDefaultCharset UTF-8

# Protect sensitive files
<FilesMatch "^\.ht|security\.php$">
    Order deny,allow
    Deny from all
</FilesMatch>

# Restrict access to PHP files from external domains - comment out for local development
#<IfModule mod_rewrite.c>
#    RewriteEngine On
#    RewriteCond %{HTTP_REFERER} !^https?://(www\.)?(yourdomain\.com|localhost)(:[0-9]+)?/ [NC]
#    RewriteCond %{REQUEST_URI} \.(php)$ [NC]
#    RewriteCond %{REQUEST_URI} !^/login\.php$ [NC]
#    RewriteRule .* - [F,L]
#</IfModule>


# Prevent access to specific file types
<FilesMatch "\.(ini|log|bak|sql|json|config)$">
    Order deny,allow
    Deny from all
</FilesMatch>

# Restrict PHP file uploads and execution
<IfModule mod_php.c>
    php_flag file_uploads On
    php_flag upload_tmp_dir /tmp
    php_flag session.use_cookies On
    php_flag session.use_only_cookies On
    php_flag session.cookie_httponly On
    # Comment out secure cookie for localhost (non-HTTPS) development
    # php_flag session.cookie_secure On
    php_flag session.cookie_samesite Strict
    php_value max_execution_time 300
    php_value max_input_time 300
    php_value memory_limit 128M
    php_value post_max_size 64M
    php_value upload_max_filesize 32M
</IfModule>

# Protect against common vulnerabilities
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{QUERY_STRING} proc/self/environ [OR]
    RewriteCond %{QUERY_STRING} mosConfig_[a-zA-Z_]{1,21}(=|\%3D) [OR]
    RewriteCond %{QUERY_STRING} base64_encode.*\(.*\) [OR]
    RewriteCond %{QUERY_STRING} (<|%3C).*script.*(>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
    RewriteRule .* index.php [F,L]
</IfModule>

# Disable server signature
ServerSignature Off
